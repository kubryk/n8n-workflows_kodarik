{
  "name": "ip check",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {}
          ]
        }
      },
      "id": "8ba86a9a-98fe-47e3-9358-e5e97c5ed0d5",
      "name": "–ó–∞–ø—É—Å–∫ 1 —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏",
      "type": "n8n-nodes-base.scheduleTrigger",
      "position": [
        -1168,
        -2704
      ],
      "typeVersion": 1.2
    },
    {
      "parameters": {
        "url": "=https://api.abuseipdb.com/api/v2/check?ipAddress={{ $json.ip }} ",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {}
      },
      "id": "e3602a73-eb32-4b5f-89d8-22c7f3dec46e",
      "name": "–ó–∞–ø–∏—Ç –¥–æ Blacklist API",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -1168,
        -2352
      ],
      "typeVersion": 4.2,
      "credentials": {
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "30182fcb-5f61-460c-a444-c1e1feecc245",
              "operator": {
                "type": "number",
                "operation": "gt"
              },
              "leftValue": "={{ $json.averageScore }}",
              "rightValue": 50
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "445d1ed9-3d18-4680-96a8-246f42c59b7c",
      "name": "–í —á–æ—Ä–Ω–æ–º—É —Å–ø–∏—Å–∫—É?",
      "type": "n8n-nodes-base.if",
      "position": [
        -1008,
        -2192
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "jsCode": "const dnsResponse = $input.first().json.Answer;\nconst domain = $input.first().json.Question[0].name.replace(/\\.$/, ''); // –ø—Ä–∏–±–∏—Ä–∞—î–º–æ –∫—Ä–∞–ø–∫—É –≤ –∫—ñ–Ω—Ü—ñ\n\n// –°—Ç–≤–æ—Ä—é—î–º–æ –º–∞—Å–∏–≤ –æ–±‚Äô—î–∫—Ç—ñ–≤, –ø–æ –æ–¥–Ω–æ–º—É –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ IP\nreturn dnsResponse.map(a => {\n  return { \n    json: { \n      domain: domain, \n      ip: a.data \n    } \n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1008,
        -2560
      ],
      "id": "f5502897-6f24-4cc5-ab2b-18cc068e2d82",
      "name": "—ñ—Ä"
    },
    {
      "parameters": {
        "url": "=https://dns.google/resolve?name={{ $json.dommains }}&type=A ",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1168,
        -2528
      ],
      "id": "37f95f34-2b9b-400b-aa7f-00b8751001af",
      "name": "–∑–∞–ø–∏—Ç –Ω–∞ dns"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "77694c29-5c74-428c-8a48-496be753acad",
              "name": "=data",
              "value": "={{ $json.data }}",
              "type": "object"
            },
            {
              "id": "ac75a9e5-16a8-48ad-bdb4-2cf8599940f4",
              "name": "domain",
              "value": "={{ $('—ñ—Ä').item.json.domain }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1008,
        -2384
      ],
      "id": "22416b68-90dc-4cd0-ae8f-7974655cae26",
      "name": "–¥–∞–Ω—ñ"
    },
    {
      "parameters": {
        "jsCode": "const grouped = {};\n\n// –ì—Ä—É–ø—É—î–º–æ –ø–æ –¥–æ–º–µ–Ω—É —Ç–∞ —Å—É–º—É—î–º–æ abuseConfidenceScore\nitems.forEach(item => {\n    const domain = item.json.domain;\n    const score = item.json.data.abuseConfidenceScore || 0;\n\n    if (!grouped[domain]) {\n        grouped[domain] = {\n            totalScore: 0,\n            count: 0\n        };\n    }\n\n    grouped[domain].totalScore += score;\n    grouped[domain].count += 1;\n});\n\n// –ü–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ –Ω–∞ –º–∞—Å–∏–≤ –¥–ª—è n8n\nreturn Object.keys(grouped).map(domain => ({\n    json: {\n        domain: domain,\n        totalScore: grouped[domain].totalScore,\n        averageScore: grouped[domain].count > 0 ? (grouped[domain].totalScore / grouped[domain].count) : 0\n    }\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1168,
        -2160
      ],
      "id": "72c72096-a14c-47e9-98f6-71cc3dcca562",
      "name": "–≥—Ä—É–ø—É—î–º–æ"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a1936b62-1bbd-48c1-b0f7-f3ab92bc70e4",
              "name": "dommains",
              "value": " [\"n8n.io\"]",
              "type": "array"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1008,
        -2752
      ],
      "id": "87bba56b-6b87-4339-8b69-29635a5d72dc",
      "name": "–¥–æ–º–µ–Ω–∏"
    },
    {
      "parameters": {
        "chatId": "=—Ç—É—Ç –≤—Å—Ç–∞–≤–∏—Ç–∏ —á–∞—Ç —ñ–¥",
        "text": "=üö® *–¢–ï–†–ú–Ü–ù–û–í–û* üö® *{{ $json.domain }} –º–∞—î —Ä–µ–π—Ç–∏–Ω–≥ {{ $json.averageScore }}*.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -784,
        -2288
      ],
      "id": "b31fc858-4d6a-448d-9b4c-4e2f4111c2a8",
      "name": "Message to tg",
      "webhookId": "9bbe2743-f3c5-4caa-8420-343d86d0f060",
      "credentials": {
      }
    }
  ],
  "pinData": {},
  "connections": {
    "–ó–∞–ø—É—Å–∫ 1 —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏": {
      "main": [
        [
          {
            "node": "–¥–æ–º–µ–Ω–∏",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ó–∞–ø–∏—Ç –¥–æ Blacklist API": {
      "main": [
        [
          {
            "node": "–¥–∞–Ω—ñ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–í —á–æ—Ä–Ω–æ–º—É —Å–ø–∏—Å–∫—É?": {
      "main": [
        [
          {
            "node": "Message to tg",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "—ñ—Ä": {
      "main": [
        [
          {
            "node": "–ó–∞–ø–∏—Ç –¥–æ Blacklist API",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–∑–∞–ø–∏—Ç –Ω–∞ dns": {
      "main": [
        [
          {
            "node": "—ñ—Ä",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–¥–∞–Ω—ñ": {
      "main": [
        [
          {
            "node": "–≥—Ä—É–ø—É—î–º–æ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–≥—Ä—É–ø—É—î–º–æ": {
      "main": [
        [
          {
            "node": "–í —á–æ—Ä–Ω–æ–º—É —Å–ø–∏—Å–∫—É?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–¥–æ–º–µ–Ω–∏": {
      "main": [
        [
          {
            "node": "–∑–∞–ø–∏—Ç –Ω–∞ dns",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "f0edd85b-62b6-422a-88d9-6e9c17f52dc2",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "4c23a816965dd7142d39c31f3ac0263da3d17c48e067f721567e0849a8b61549"
  },
  "id": "XQoTCNvg9vxy6QEw",
  "tags": []
}